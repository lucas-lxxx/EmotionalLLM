`torch_dtype` is deprecated! Use `dtype` instead!
INFO:src.configuration_omnispeech:audio encoder config is None. Initializing with qwen2_audio_encoder
INFO:src.configuration_omnispeech:llm config is None. Initializing with qwen3
INFO:src.configuration_omnispeech:tts lm config is None. Initializing with qwen3
Loading model...
Loading checkpoint shards:   0%|          | 0/5 [00:00<?, ?it/s]Loading checkpoint shards:  20%|██        | 1/5 [00:00<00:03,  1.14it/s]Loading checkpoint shards:  40%|████      | 2/5 [00:01<00:02,  1.20it/s]Loading checkpoint shards:  60%|██████    | 3/5 [00:02<00:01,  1.25it/s]Loading checkpoint shards:  80%|████████  | 4/5 [00:03<00:00,  1.28it/s]Loading checkpoint shards: 100%|██████████| 5/5 [00:03<00:00,  1.60it/s]Loading checkpoint shards: 100%|██████████| 5/5 [00:03<00:00,  1.41it/s]
/data1/lixiang/Opens2s/OpenS2S/venv/lib/python3.12/site-packages/torchaudio/functional/functional.py:584: UserWarning: At least one mel filterbank has all zero values. The value for `n_mels` (128) may be set too high. Or, the value for `n_freqs` (201) may be set too low.
  warnings.warn(
The following generation flags are not valid and may be ignored: ['temperature']. Set `TRANSFORMERS_VERBOSITY=info` for more details.
`generation_config` default values have been modified to match model-specific defaults: {'bos_token_id': 151643}. If this is not desired, please set these values explicitly.
Enabled gradient checkpointing on llm_model
Enabled gradient checkpointing on audio_encoder_model

################################################################################
# Testing Model's Natural Response (NO PROMPT)
# Samples: 5 Sad audio files
# Config: sr=24000, n_fft=400, hop=160
################################################################################

================================================================================
Testing: 20683.wav
================================================================================
Audio: sr=24000, duration=4.76s

>>> NO PROMPT - Just audio <<<

Input shapes:
  input_ids: torch.Size([1, 16])
  speech_values: torch.Size([1, 128, 3000])

================================================================================
MODEL'S NATURAL RESPONSE (No Prompt)
================================================================================
Generating (max 200 tokens)...

Generated 10 tokens

================================================================================
TOKEN-BY-TOKEN GENERATION
================================================================================
Token   0: id= 99692 -> '好的'
Token   1: id=  3837 -> '，'
Token   2: id= 35946 -> '我'
Token   3: id= 36407 -> '来'
Token   4: id=108400 -> '帮你'
Token   5: id=101042 -> '分析'
Token   6: id=100158 -> '一下'
Token   7: id=  1773 -> '。'
Token   8: id=151672 -> '<|im_tts_end|>' [SPECIAL]
Token   9: id=151645 -> '<|im_end|>' [SPECIAL]

================================================================================
FULL OUTPUT (Special tokens removed)
================================================================================
好的，我来帮你分析一下。
================================================================================

================================================================================
TOP-5 TOKEN PROBABILITIES (First 3 Generated Tokens)
================================================================================

--- Token 0 ---
  0.0457 -> '好的' (id=99692)
  0.0403 -> '当然' (id=103942)
  0.0403 -> '"' (id=1)
  0.0403 -> '嗯' (id=106287)
  0.0403 -> '您' (id=87026)

--- Token 1 ---
  0.7579 -> '，' (id=3837)
  0.1162 -> '，请' (id=37945)
  0.0905 -> '呀' (id=104256)
  0.0108 -> '！' (id=6313)
  0.0040 -> ',' (id=11)

--- Token 2 ---
  0.2489 -> '我' (id=35946)
  0.1510 -> '正在' (id=96555)
  0.0808 -> '您' (id=87026)
  0.0490 -> '以下是' (id=114566)
  0.0433 -> '我们' (id=97639)

================================================================================
Testing: 24190.wav
================================================================================
Audio: sr=24000, duration=4.52s

>>> NO PROMPT - Just audio <<<

Input shapes:
  input_ids: torch.Size([1, 16])
  speech_values: torch.Size([1, 128, 3000])

================================================================================
MODEL'S NATURAL RESPONSE (No Prompt)
================================================================================
Generating (max 200 tokens)...

Generated 10 tokens

================================================================================
TOKEN-BY-TOKEN GENERATION
================================================================================
Token   0: id= 99692 -> '好的'
Token   1: id=  3837 -> '，'
Token   2: id= 35946 -> '我'
Token   3: id= 36407 -> '来'
Token   4: id=108400 -> '帮你'
Token   5: id=101042 -> '分析'
Token   6: id=100158 -> '一下'
Token   7: id=  1773 -> '。'
Token   8: id=151672 -> '<|im_tts_end|>' [SPECIAL]
Token   9: id=151645 -> '<|im_end|>' [SPECIAL]

================================================================================
FULL OUTPUT (Special tokens removed)
================================================================================
好的，我来帮你分析一下。
================================================================================

================================================================================
TOP-5 TOKEN PROBABILITIES (First 3 Generated Tokens)
================================================================================

--- Token 0 ---
  0.0850 -> '好的' (id=99692)
  0.0662 -> '嗯' (id=106287)
  0.0515 -> '当然' (id=103942)
  0.0455 -> '您' (id=87026)
  0.0401 -> '好' (id=52801)

--- Token 1 ---
  0.7729 -> '，' (id=3837)
  0.1046 -> '呀' (id=104256)
  0.0923 -> '，请' (id=37945)
  0.0086 -> '！' (id=6313)
  0.0041 -> '小朋友' (id=106798)

--- Token 2 ---
  0.2502 -> '我' (id=35946)
  0.1949 -> '正在' (id=96555)
  0.0633 -> '您' (id=87026)
  0.0558 -> '以下是' (id=114566)
  0.0435 -> '我们' (id=97639)

================================================================================
Testing: 15822.wav
================================================================================
Audio: sr=24000, duration=4.48s

>>> NO PROMPT - Just audio <<<

Input shapes:
  input_ids: torch.Size([1, 16])
  speech_values: torch.Size([1, 128, 3000])

================================================================================
MODEL'S NATURAL RESPONSE (No Prompt)
================================================================================
Generating (max 200 tokens)...

Generated 9 tokens

================================================================================
TOKEN-BY-TOKEN GENERATION
================================================================================
Token   0: id= 99692 -> '好的'
Token   1: id=  3837 -> '，'
Token   2: id= 35946 -> '我'
Token   3: id= 36407 -> '来'
Token   4: id=108400 -> '帮你'
Token   5: id=105839 -> '想想'
Token   6: id=  1773 -> '。'
Token   7: id=113540 -> '你喜欢'
Token   8: id=151645 -> '<|im_end|>' [SPECIAL]

================================================================================
FULL OUTPUT (Special tokens removed)
================================================================================
好的，我来帮你想想。你喜欢
================================================================================

================================================================================
TOP-5 TOKEN PROBABILITIES (First 3 Generated Tokens)
================================================================================

--- Token 0 ---
  0.0780 -> '好的' (id=99692)
  0.0536 -> '嗯' (id=106287)
  0.0536 -> '好' (id=52801)
  0.0536 -> '今天' (id=100644)
  0.0473 -> '当然' (id=103942)

--- Token 1 ---
  0.7699 -> '，' (id=3837)
  0.1042 -> '呀' (id=104256)
  0.0920 -> '，请' (id=37945)
  0.0097 -> '！' (id=6313)
  0.0067 -> '小朋友' (id=106798)

--- Token 2 ---
  0.2311 -> '我' (id=35946)
  0.2040 -> '正在' (id=96555)
  0.0662 -> '我们' (id=97639)
  0.0455 -> '您' (id=87026)
  0.0402 -> '让我们' (id=104233)

================================================================================
Testing: 22344.wav
================================================================================
Audio: sr=24000, duration=4.88s

>>> NO PROMPT - Just audio <<<

Input shapes:
  input_ids: torch.Size([1, 16])
  speech_values: torch.Size([1, 128, 3000])

================================================================================
MODEL'S NATURAL RESPONSE (No Prompt)
================================================================================
Generating (max 200 tokens)...

Generated 10 tokens

================================================================================
TOKEN-BY-TOKEN GENERATION
================================================================================
Token   0: id= 99692 -> '好的'
Token   1: id=  3837 -> '，'
Token   2: id= 35946 -> '我'
Token   3: id= 36407 -> '来'
Token   4: id=108400 -> '帮你'
Token   5: id=101042 -> '分析'
Token   6: id=100158 -> '一下'
Token   7: id=  1773 -> '。'
Token   8: id=151672 -> '<|im_tts_end|>' [SPECIAL]
Token   9: id=151645 -> '<|im_end|>' [SPECIAL]

================================================================================
FULL OUTPUT (Special tokens removed)
================================================================================
好的，我来帮你分析一下。
================================================================================

================================================================================
TOP-5 TOKEN PROBABILITIES (First 3 Generated Tokens)
================================================================================

--- Token 0 ---
  0.1005 -> '好的' (id=99692)
  0.0610 -> '嗯' (id=106287)
  0.0610 -> '当然' (id=103942)
  0.0538 -> '好' (id=52801)
  0.0419 -> '您' (id=87026)

--- Token 1 ---
  0.7510 -> '，' (id=3837)
  0.1152 -> '呀' (id=104256)
  0.1016 -> '，请' (id=37945)
  0.0083 -> '！' (id=6313)
  0.0045 -> '小朋友' (id=106798)

--- Token 2 ---
  0.2585 -> '我' (id=35946)
  0.1776 -> '正在' (id=96555)
  0.0653 -> '您' (id=87026)
  0.0449 -> '我们' (id=97639)
  0.0396 -> '让我们' (id=104233)

================================================================================
Testing: 20495.wav
================================================================================
Audio: sr=24000, duration=7.56s

>>> NO PROMPT - Just audio <<<

Input shapes:
  input_ids: torch.Size([1, 16])
  speech_values: torch.Size([1, 128, 3000])

================================================================================
MODEL'S NATURAL RESPONSE (No Prompt)
================================================================================
Generating (max 200 tokens)...

Generated 9 tokens

================================================================================
TOKEN-BY-TOKEN GENERATION
================================================================================
Token   0: id= 99692 -> '好的'
Token   1: id=  3837 -> '，'
Token   2: id= 35946 -> '我'
Token   3: id= 36407 -> '来'
Token   4: id=108400 -> '帮你'
Token   5: id=105839 -> '想想'
Token   6: id=  1773 -> '。'
Token   7: id=113540 -> '你喜欢'
Token   8: id=151645 -> '<|im_end|>' [SPECIAL]

================================================================================
FULL OUTPUT (Special tokens removed)
================================================================================
好的，我来帮你想想。你喜欢
================================================================================

================================================================================
TOP-5 TOKEN PROBABILITIES (First 3 Generated Tokens)
================================================================================

--- Token 0 ---
  0.0901 -> '好的' (id=99692)
  0.0620 -> '嗯' (id=106287)
  0.0620 -> '好' (id=52801)
  0.0547 -> '当然' (id=103942)
  0.0426 -> '您' (id=87026)

--- Token 1 ---
  0.7454 -> '，' (id=3837)
  0.1295 -> '呀' (id=104256)
  0.0890 -> '，请' (id=37945)
  0.0094 -> '！' (id=6313)
  0.0050 -> '小朋友' (id=106798)

--- Token 2 ---
  0.2521 -> '我' (id=35946)
  0.1732 -> '正在' (id=96555)
  0.0637 -> '您' (id=87026)
  0.0438 -> '让我们' (id=104233)
  0.0438 -> '我们' (id=97639)

################################################################################
# SUMMARY
################################################################################

20683.wav:
  好的，我来帮你分析一下。

24190.wav:
  好的，我来帮你分析一下。

15822.wav:
  好的，我来帮你想想。你喜欢

22344.wav:
  好的，我来帮你分析一下。

20495.wav:
  好的，我来帮你想想。你喜欢

################################################################################
# Test Complete
################################################################################
