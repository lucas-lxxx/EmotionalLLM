

- **Prompt 要求**：OpenS2S 直接输出音频的情绪标签
  - 默认 prompt: `"What is the emotion of this audio? Please answer with only the emotion label (e.g., happy, sad, neutral)."`
- **评估方法**：从 OpenS2S 的输出文本中直接提取情绪标签
- **优势**：
  1. 直接评估音频的情绪识别结果
  2. 更符合实际应用场景（用户想知道音频的情绪）
  3. 避免了文本生成的不确定性
  4. 更科学、更直接

## 情绪提取方法

### 关键词匹配
从 OpenS2S 的输出文本中查找情绪关键词：

- **Happy**: happy, happiness, joy, joyful, cheerful, glad, pleased, delighted
- **Sad**: sad, sadness, sorrow, unhappy, depressed, melancholy, gloomy
- **Neutral**: neutral, calm, normal, flat, emotionless
- **Angry**: angry, anger, mad, furious, irritated
- **Fear**: fear, afraid, scared, frightened, anxious
- **Surprise**: surprise, surprised, shocked, amazed
- **Disgust**: disgust, disgusted, revolted

### 评分机制
1. 关键词出现次数（考虑词边界）
2. 如果情绪词出现在文本开头，给予更高权重
3. 如果文本完全匹配某个情绪词，给予最高权重
4. 归一化为概率分布

## 翻转率计算

### 成功翻转的定义
1. **明确翻转**：`emo_clean == 'sad'` 且 `emo_adv == 'happy'`
2. **概率提升**：`p_happy_adv > p_sad_adv` 且 `delta_happy > 0` 且 `delta_sad < 0`
3. **输出 happy**：`emo_adv == 'happy'` 且 `delta_happy > 0.1`

满足任一条件即认为翻转成功。

## 评估指标

### 1. 情绪翻转率 (EFR)
- 定义：成功翻转的样本数 / 总样本数
- 计算：基于上述翻转定义

### 2. Delta Happy
- 定义：`p_happy_adv - p_happy_clean`
- 意义：Happy 概率的提升幅度

### 3. 语义相似度
- 使用 Sentence-BERT 计算 clean 和 adv 文本的语义相似度
- 范围：[0, 1]，越高越好

### 4. 音频扰动指标
- **L2 范数**：扰动的 L2 范数
- **SNR**：信噪比（dB），越高越好

## 使用建议

1. **Prompt 设计**：建议使用明确的 prompt，要求模型输出情绪标签
2. **输出格式**：可以要求模型输出结构化格式（如 JSON），便于解析
3. **关键词扩展**：根据实际输出情况，可以扩展情绪关键词列表

## 示例

### 输入 Prompt
```
What is the emotion of this audio? Please answer with only the emotion label (e.g., happy, sad, neutral).
```

### 可能的输出
- `"happy"` → 提取为 `happy`
- `"The emotion is sad."` → 提取为 `sad`
- `"This audio sounds joyful and cheerful."` → 提取为 `happy`（多个关键词匹配）

### 评估结果
- `emo_clean`: 从 clean 文本提取的情绪
- `emo_adv`: 从 adv 文本提取的情绪
- `emotion_flip`: 是否成功翻转（0/1）

